---
layout: post
title:  GetLongPathName API 的路径大小写问题
date: 2017-08-09 00:01:00 +0000
tags:
  windows
---

众所周知 Windows 下路径是不区分大小写，导致使用 Windows 时候经常会遇见奇怪的路径大小写不区分的情况，在 Windows 内还好，一旦遇到了大小写敏感的情景有可能成为奇怪 bug 的原因。

起因是写一个自动保存 Project 的组件的时候，当打开自动保存的 Project，如果这个 Project 是来自自动保存的文件夹，那么在标题栏就不显示真实的文件路径，而是显示源文件的路径。完成后在我的机器上工作的很好，但在同事的机器上却无法正确工作，标题栏依然显示真实的文件路径。

一下子便怀疑到是否判断当前文件路径是不是在自动保存文件夹的路径下的函数返回了 false。debug 到那里果然是返回了 false。

为什么返回 false，找到是因为传入的文件路径中包含了与被比较的路径不一样的大小写字符，虽然在 Windows 下是一样的，但 code 里使用了 case sensitive 的字符串比较，导致了判断错误。

但是为什么传入的文件路径会和被比较的路径发生大小写不一致的问题呢？原来是因为传入的文件路径中途经过了一个 Windows API GetLongPathName，本意是为了显示早期 Windows 不支持长路径名显示而缩写的 C:\Progra~1 这类路径。而我们的路径字符串经过了这个 API 的处理，有一个字母变成了大写。

自此问题解决，使用了大小写不敏感的字符串对比函数即可。
